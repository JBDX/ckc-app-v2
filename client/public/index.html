<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookies Challenge</title>
    <!-- Liens CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles/style.css">
    <script src="https://kit.fontawesome.com/00615e493d.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Style pour les logos images -->
    <style>
        .team-block__logo img {
            max-width: 60px;
            max-height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
        .team-block__name {
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <header class="page-header">
            <div class="page-header__actions">
                <a href="login.html" class="btn btn-secondary me-2"><i class="fa-solid fa-circle-user"></i> CONNEXION</a>
            </div>
            <div class="page-header__logo">
                 <img src="/components/v2006_54.png" alt="Logo Cookies Challenge" class="img-fluid">
            </div>
        </header>
        <main class="mb-5">
            <div id="teams-container" class="row g-4">
                <p class="text-center text-muted">Chargement des équipes...</p>
            </div>
        </main>
        <section>
            <div class="text-center">
                <h2 class="section-title">ACTIVITÉS RÉCENTES</h2>
            </div>
            <ul id="history-list" class="list-group list-group-flush">
                <li class="list-group-item text-center text-muted">Chargement de l'historique...</li>
            </ul>
        </section>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const teamsContainer = document.getElementById('teams-container');
        const historyList = document.getElementById('history-list');

        async function updateDashboard() {
            // ... (logique de fetch inchangée)
            try {
                const [teamsResponse, historyResponse] = await Promise.all([
                    fetch('/api/teams'),
                    fetch('/api/teams/history')
                ]);
                 if (!teamsResponse.ok || !historyResponse.ok) throw new Error('Erreur serveur.');
                const teams = await teamsResponse.json();
                const history = await historyResponse.json();
                updateTeamsDisplay(teams);
                updateHistoryDisplay(history);
            } catch (error) {
                teamsContainer.innerHTML = `<p class="text-center text-danger">${error.message}</p>`;
                historyList.innerHTML = `<li class="list-group-item text-center text-danger">Impossible de charger les activités.</li>`;
            }
        }

        function updateTeamsDisplay(teams) {
            teamsContainer.innerHTML = '';
            teams.forEach(team => {
                const teamColor = team.name.replace('s', '');
                // --- CORRECTION ICI : On utilise une balise <img> ---
                const logoDisplay = `<img src="${team.logo}" alt="Logo ${team.name}">`;

                const teamBlock = `
                    <div class="col-6 col-lg-3">
                        <div class="team-block team-block--${teamColor} h-100">
                            <div class="team-block__logo">${logoDisplay}</div>
                            <div class="team-block__name">${team.name}</div>
                            <div class="team-block__points">${team.score} PTS</div>
                        </div>
                    </div>`;
                teamsContainer.innerHTML += teamBlock;
            });
        }

        function updateHistoryDisplay(history) {
            // ... (logique de l'historique inchangée)
            historyList.innerHTML = '';
            if (history.length === 0) {
                 historyList.innerHTML = '<li class="list-group-item text-center text-muted">Aucune activité pour le moment.</li>';
                 return;
            }
            history.forEach(item => {
                const badgeClass = item.points_change > 0 ? 'text-bg-success' : 'text-bg-danger';
                const pointsSign = item.points_change > 0 ? '+' : '';
                const historyItem = `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong class="text-capitalize">${item.team_name}</strong>
                            <small class="d-block text-muted">${item.reason}</small>
                        </div>
                        <span class="badge ${badgeClass} rounded-pill fs-6">${pointsSign}${item.points_change}</span>
                    </li>`;
                historyList.innerHTML += historyItem;
            });
        }

        updateDashboard();
    });
    </script>
</body>
</html>